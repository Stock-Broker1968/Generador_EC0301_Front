<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plataforma EC0301 - Dashboard</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script src="sistema_central/auth.js" defer></script>
    <script src="sistema_central/ec0301-data-manager.js" defer></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Esperamos un poco para asegurar que auth.js se cargó
            setTimeout(() => {
                if (typeof auth === 'undefined') {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error de Carga',
                        text: 'No se pudo cargar el módulo de autenticación. Revisa tu conexión o recarga la página.',
                        confirmButtonColor: '#ef4444'
                    });
                    return;
                }

                // Verificar sesión
                if (!auth.isLoggedIn()) {
                    window.location.href = 'index.html';
                } else {
                    // Inicializar Dashboard
                    initDashboard();
                }
            }, 100);
        });

        function initDashboard() {
            const user = localStorage.getItem('ec0301_token'); // O decodificar si usas JWT
            // Aquí puedes agregar lógica para mostrar el nombre del usuario si lo tienes guardado
            
            // Desbloqueo de módulos (Lógica de candados)
            const cartaData = EC0301Manager.getData();
            const cartaCompleta = cartaData && cartaData.nombre; // Lógica simple: si tiene nombre, avanza

            if (cartaCompleta) {
                document.querySelectorAll('.module-card').forEach(card => {
                    card.classList.remove('locked');
                    const btn = card.querySelector('.btn-action');
                    if(btn) {
                        btn.disabled = false;
                        btn.classList.remove('btn-disabled');
                        btn.classList.add('btn-primary');
                        btn.innerHTML = 'Acceder <i class="fas fa-arrow-right"></i>';
                    }
                });
            }
        }

        function logout() {
            auth.logout();
        }
    </script>

    <style>
        :root {
            --primary: #6366f1;
            --dark: #1e293b;
            --light: #f8fafc;
        }
        body { font-family: sans-serif; background: var(--light); margin: 0; }
        .navbar { background: white; padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .logo { font-size: 1.5rem; font-weight: bold; color: var(--primary); display: flex; align-items: center; gap: 10px; }
        .container { max-width: 1200px; margin: 2rem auto; padding: 0 1rem; }
        .welcome-banner { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 2rem; border-radius: 15px; margin-bottom: 2rem; }
        
        .grid-modules { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; }
        .module-card { background: white; padding: 1.5rem; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); transition: transform 0.3s; border: 1px solid #e2e8f0; position: relative; }
        .module-card:hover { transform: translateY(-5px); }
        
        /* Estilo Bloqueado */
        .module-card.locked { opacity: 0.7; background: #f1f5f9; }
        .module-card.locked::after { content: "\f023"; font-family: "Font Awesome 6 Free"; font-weight: 900; position: absolute; top: 1rem; right: 1rem; font-size: 1.5rem; color: #94a3b8; }
        
        .icon-box { width: 50px; height: 50px; background: #e0e7ff; border-radius: 10px; display: flex; align-items: center; justify-content: center; color: var(--primary); font-size: 1.5rem; margin-bottom: 1rem; }
        h3 { margin: 0 0 0.5rem 0; color: var(--dark); }
        p { color: #64748b; font-size: 0.9rem; margin-bottom: 1.5rem; }
        
        .btn-action { width: 100%; padding: 0.8rem; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: #4f46e5; }
        .btn-disabled { background: #cbd5e1; color: #64748b; cursor: not-allowed; }
    </style>
</head>
<body>

    <nav class="navbar">
        <div class="logo"><i class="fas fa-graduation-cap"></i> Plataforma EC0301</div>
        <button onclick="logout()" style="background:none; border:1px solid #e2e8f0; padding:0.5rem 1rem; border-radius:6px; cursor:pointer;">
            <i class="fas fa-sign-out-alt"></i> Cerrar Sesión
        </button>
    </nav>

    <div class="container">
        <div class="welcome-banner">
            <h1>Bienvenido a tu Plataforma</h1>
            <p>Selecciona un módulo para comenzar a generar tus productos.</p>
        </div>

        <div class="grid-modules">
            <div class="module-card">
                <div class="icon-box"><i class="fas fa-file-contract"></i></div>
                <h3>Carta Descriptiva</h3>
                <p>Genera el guion instruccional completo para tu curso en línea.</p>
                <button class="btn-action btn-primary" onclick="window.location.href='carta_descriptiva.html'">
                    Acceder <i class="fas fa-arrow-right"></i>
                </button>
            </div>

            <div class="module-card locked">
                <div class="icon-box"><i class="fas fa-tasks"></i></div>
                <h3>Instrumentos de Evaluación</h3>
                <p>Crea las rúbricas, listas de cotejo y guías de observación.</p>
                <button class="btn-action btn-disabled" onclick="window.location.href='evaluaciones.html'" disabled>
                    Bloqueado <i class="fas fa-lock"></i>
                </button>
            </div>

            <div class="module-card locked">
                <div class="icon-box"><i class="fas fa-book-open"></i></div>
                <h3>Manuales del Curso</h3>
                <p>Desarrolla los manuales del participante y del facilitador.</p>
                <button class="btn-action btn-disabled" onclick="window.location.href='manuales.html'" disabled>
                    Bloqueado <i class="fas fa-lock"></i>
                </button>
            </div>

            <div class="module-card locked">
                <div class="icon-box"><i class="fas fa-truck"></i></div>
                <h3>Logística y Formatos</h3>
                <p>Genera la lista de asistencia, contrato y lista de requerimientos.</p>
                <button class="btn-action btn-disabled" onclick="window.location.href='logistica.html'" disabled>
                    Bloqueado <i class="fas fa-lock"></i>
                </button>
            </div>

            <div class="module-card locked">
                <div class="icon-box"><i class="fas fa-key"></i></div>
                <h3>Hoja de Respuestas</h3>
                <p>Genera la clave de respuestas de la evaluación sumativa.</p>
                <button class="btn-action btn-disabled" onclick="window.location.href='respuestas.html'" disabled>
                    Bloqueado <i class="fas fa-lock"></i>
                </button>
            </div>

            <div class="module-card locked">
                <div class="icon-box"><i class="fas fa-shield-alt"></i></div>
                <h3>Auditoría EC0301</h3>
                <p>Valida tu portafolio de productos contra el estándar.</p>
                <button class="btn-action btn-disabled" onclick="window.location.href='auditoria.html'" disabled>
                    Bloqueado <i class="fas fa-lock"></i>
                </button>
            </div>

             <div class="module-card locked" style="background-color: #475569; color: white; border: none;">
                <div class="icon-box" style="background: rgba(255,255,255,0.2); color: white;"><i class="fas fa-file-archive"></i></div>
                <h3 style="color: white;">Exportar Portafolio</h3>
                <p style="color: #cbd5e1;">Genera tu portafolio final en PDF o .ZIP para la auditoría.</p>
                <button class="btn-action btn-disabled" onclick="window.location.href='exportar.html'" disabled style="background: rgba(255,255,255,0.1); color: white;">
                    Bloqueado <i class="fas fa-lock"></i>
                </button>
            </div>

        </div>
    </div>

</body>
</html>
